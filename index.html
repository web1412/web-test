<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap">
    <style>
      body {
        font-family: 'Kanit', Arial, sans-serif;
        background-color: #f9f9f9;
        margin: 0;
        padding: 0;
      }
      h1 {
        text-align: center;
        padding: 20px;
        background-color: #4CAF50;
        color: white;
        margin: 0;
        font-weight: 700;
      }
      #searchContainer {
        text-align: center;
        padding: 10px;
        margin-bottom: 20px;
      }
      #searchInput {
        width: 80%;
        padding: 10px;
        font-size: 20px;
        border: 1px solid #ddd;
        border-radius: 9px;
        font-family: 'Kanit', Arial, sans-serif;
      }
      #refreshContainer {
        text-align: center;
        padding: 10px;
        margin-bottom: 20px;
      }
      #refreshButton {
        padding: 10px 20px;
        font-size: 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-family: 'Kanit', Arial, sans-serif;
      }
      #refreshButton:hover {
        background-color: #45a049;
      }
      #refreshDescription {
        font-size: 18px;
        color: #777;
        font-family: 'Kanit', Arial, sans-serif;
        margin-top: 5px;
      }
      #product-container-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        width: 100%;
        padding: 0 10px;
        box-sizing: border-box;
        min-height: 300px;
      }
      #product-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        width: 100%;
      }
      .product {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 10px;
        margin: 10px;
        display: inline-block;
        text-align: center;
        width: 242px;
        height: 374px;
        vertical-align: top;
        box-sizing: border-box;
        background-color: white;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: box-shadow 0.2s;
        font-family: 'Kanit', Arial, sans-serif;
      }
      .product:hover {
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }
      .product img {
        max-width: 100%;
        max-height: 165px;
        border-bottom: 1px solid #ddd;
        margin-bottom: 10px;
        padding-bottom: 10px;
      }
      .product h2 {
        font-size: 22px;
        color: #333;
        margin: 10px 0;
        font-weight: 600;
      }
      .product p {
        margin: 5px 0;
        color: #777;
      }
      .product p.price {
        font-size: 18px;
        color: #4CAF50;
        font-weight: 600;
      }
      .product p.stock {
        font-size: 16px;
        color: #e91e63;
        font-weight: 600;
      }

      /* Notification Styles */
      .notification {
        display: none;
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #d4edda;
        color: #155724;
        padding: 15px;
        border: 1px solid #c3e6cb;
        border-radius: 5px;
        font-family: 'Kanit', Arial, sans-serif;
        font-size: 18px;
        z-index: 1000;
      }

      /* Media Queries สำหรับ Mobile L, M, S */
      @media (max-width: 1200px) {
        body {
          font-size: 176%;
        }
        h1 {
          font-size: 176%;
          padding: 36px;
        }
        #searchInput {
          font-size: 45.74px;
        }
        .product {
          width: calc(242px * 1.815);
          height: calc(374px * 1.815);
        }
        .product img {
          max-height: calc(165px * 1.815 * 1.2);
        }
        .product h2 {
          font-size: calc(22px * 1.815 * 1.1);
        }
        .product p.price {
          font-size: calc(18px * 1.815 * 1.1);
        }
        .product p.stock {
          font-size: calc(16px * 1.815 * 1.1);
        }
        #refreshButton {
          font-size: 30px;
          padding: 15px 30px;
        }
        #refreshDescription {
          font-size: 27px;
        }
        .loader-text {
          font-size: calc(27px + 30px);
        }
        .loader-text span {
          font-size: calc(27px + 30px);
        }
        .notification {
          font-size: 30px;
        }
      }

      @media (max-width: 992px) {
        body {
          font-size: 176%;
        }
        h1 {
          font-size: 176%;
          padding: 36px;
        }
        #searchInput {
          font-size: 45.74px;
        }
        .product {
          width: calc(242px * 1.815);
          height: calc(374px * 1.815);
        }
        .product img {
          max-height: calc(165px * 1.815 * 1.2);
        }
        .product h2 {
          font-size: calc(22px * 1.815 * 1.1);
        }
        .product p.price {
          font-size: calc(18px * 1.815 * 1.1);
        }
        .product p.stock {
          font-size: calc(16px * 1.815 * 1.1);
        }
        #refreshButton {
          font-size: 30px;
          padding: 15px 30px;
        }
        #refreshDescription {
          font-size: 27px;
        }
        .loader-text {
          font-size: calc(27px + 30px);
        }
        .loader-text span {
          font-size: calc(27px + 30px);
        }
        .notification {
          font-size: 30px;
        }
      }

      @media (max-width: 768px) {
        body {
          font-size: 176%;
        }
        h1 {
          font-size: 176%;
          padding: 36px;
        }
        #searchInput {
          font-size: 45.74px;
        }
        .product {
          width: calc(242px * 1.815);
          height: calc(374px * 1.815);
        }
        .product img {
          max-height: calc(165px * 1.815 * 1.2);
        }
        .product h2 {
          font-size: calc(22px * 1.815 * 1.1);
        }
        .product p.price {
          font-size: calc(18px * 1.815 * 1.1);
        }
        .product p.stock {
          font-size: calc(16px * 1.815 * 1.1);
        }
        #refreshButton {
          font-size: 30px;
          padding: 15px 30px;
        }
        #refreshDescription {
          font-size: 27px;
        }
        .loader-text {
          font-size: calc(27px + 30px);
        }
        .loader-text span {
          font-size: calc(27px + 30px);
        }
        .notification {
          font-size: 30px;
        }
      }

      @media (max-width: 576px) {
        body {
          font-size: 176%;
        }
        h1 {
          font-size: 176%;
          padding: 36px;
        }
        #searchInput {
          font-size: 45.74px;
        }
        .product {
          width: calc(242px * 1.815);
          height: calc(374px * 1.815);
        }
        .product img {
          max-height: calc(165px * 1.815 * 1.2);
        }
        .product h2 {
          font-size: calc(22px * 1.815 * 1.1);
        }
        .product p.price {
          font-size: calc(18px * 1.815 * 1.1);
        }
        .product p.stock {
          font-size: calc(16px * 1.815 * 1.1);
        }
        #refreshButton {
          font-size: 30px;
          padding: 15px 30px;
        }
        #refreshDescription {
          font-size: 27px;
        }
        .loader-text {
          font-size: calc(27px + 30px);
        }
        .loader-text span {
          font-size: calc(27px + 30px);
        }
        .notification {
          font-size: 30px;
        }
      }

      @media (max-width: 480px) {
        body {
          font-size: 176%;
        }
        h1 {
          font-size: 176%;
          padding: 36px;
        }
        #searchInput {
          font-size: 45.74px;
        }
        .product {
          width: calc(242px * 1.815);
          height: calc(374px * 1.815);
        }
        .product img {
          max-height: calc(165px * 1.815 * 1.2);
        }
        .product h2 {
          font-size: calc(22px * 1.815 * 1.1);
        }
        .product p.price {
          font-size: calc(18px * 1.815 * 1.1);
        }
        .product p.stock {
          font-size: calc(16px * 1.815 * 1.1);
        }
        #refreshButton {
          font-size: 30px;
          padding: 15px 30px;
        }
        #refreshDescription {
          font-size: 27px;
        }
        .loader-text {
          font-size: calc(27px + 30px);
        }
        .loader-text span {
          font-size: calc(27px + 30px);
        }
        .notification {
          font-size: 30px;
        }
      }
      .loader-text {
        display: none;
        text-align: center;
        font-size: 18px;
        color: #333;
        font-family: 'Kanit', Arial, sans-serif;
        margin-top: 10px;
      }

      .loader-text span {
        display: inline-block;
        animation: bounce 1.5s infinite;
      }

      .loader-text span:nth-child(2) {
        animation-delay: 0.3s;
      }

      .loader-text span:nth-child(3) {
        animation-delay: 0.6s;
      }

      @keyframes bounce {
        0%, 80%, 100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-10px);
        }
      }

      @media (max-width: 1200px) {
        .loader-text {
          font-size: 57px;
        }
        .loader-text span {
          font-size: 57px;
        }
      }

      @media (max-width: 992px) {
        .loader-text {
          font-size: 57px;
        }
        .loader-text span {
          font-size: 57px;
        }
      }

      @media (max-width: 768px) {
        .loader-text {
          font-size: 57px;
        }
        .loader-text span {
          font-size: 57px;
        }
      }

      @media (max-width: 576px) {
        .loader-text {
          font-size: 57px;
        }
        .loader-text span {
          font-size: 57px;
        }
      }

      @media (max-width: 480px) {
        .loader-text {
          font-size: 57px;
        }
        .loader-text span {
          font-size: 57px;
        }
      }
    </style>
    <script>
      var lastLoadedData = null;

      function showNotification(message) {
        var notification = document.getElementById('notification');
        notification.innerText = message;
        notification.style.display = 'block';
        setTimeout(function() {
          notification.style.opacity = '0';
          setTimeout(function() {
            notification.style.display = 'none';
            notification.style.opacity = '1';
          }, 1000);
        }, 3000);
      }

      function loadProducts() {
        var loaderText = document.getElementById('loader-text');
        loaderText.style.display = 'block';
        fetch('https://script.google.com/macros/s/AKfycbwH_n0CWEc3t1dyeXlPRN4p-5xqwVuYfWuQNG5YgOG09ZxFKEOwjXqlhjGNTduRL6I/exec')
          .then(response => response.json())
          .then(data => {
            // Group products by category
            var productsByCategory = {};
            data.forEach(product => {
              var category = product.category || '';
              if (!productsByCategory[category]) {
                productsByCategory[category] = [];
              }
              productsByCategory[category].push(product);
            });

            // Sort each category by price and stock
            for (var category in productsByCategory) {
              productsByCategory[category].sort((a, b) => {
                if (a.price === b.price) {
                  return b.stock - a.stock;
                }
                return a.price - b.price;
              });
            }

            if (JSON.stringify(data) === JSON.stringify(lastLoadedData)) {
              showNotification('สินค้าปัจจุบันคือสินค้าล่าสุดแล้ว');
            } else {
              lastLoadedData = data;
              showNotification('สินค้าถูกอัพเดตเข้ามาเพิ่มแล้ว');
            }

            displayProducts(productsByCategory);
          })
          .catch(error => console.error('Error:', error));
      }

      function displayProducts(productsByCategory) {
        var loaderText = document.getElementById('loader-text');
        loaderText.style.display = 'none';

        var container = document.getElementById('product-container');
        container.innerHTML = '';

        for (var category in productsByCategory) {
          if (category) {
            var categoryHeader = document.createElement('h2');
            categoryHeader.textContent = category;
            container.appendChild(categoryHeader);
          }

          productsByCategory[category].forEach(product => {
            var productDiv = document.createElement('div');
            productDiv.className = 'product';

            var img = document.createElement('img');
            img.src = product.image;
            productDiv.appendChild(img);

            var name = document.createElement('h2');
            name.textContent = product.name;
            productDiv.appendChild(name);

            var price = document.createElement('p');
            price.textContent = 'ราคา ' + product.price + ' ฿';
            price.className = 'price';
            productDiv.appendChild(price);

            var stock = document.createElement('p');
            stock.textContent = 'สินค้า ' + product.stock + ' ชิ้น';
            stock.className = 'stock';
            productDiv.appendChild(stock);

            container.appendChild(productDiv);
          });
        }
      }

      function searchProducts() {
        var input, filter, container, productDivs, h2, i, txtValue;
        input = document.getElementById('searchInput');
        filter = input.value.toUpperCase();
        container = document.getElementById('product-container');
        productDivs = container.getElementsByClassName('product');

        for (i = 0; i < productDivs.length; i++) {
          h2 = productDivs[i].getElementsByTagName('h2')[0];
          txtValue = h2.textContent || h2.innerText;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            productDivs[i].style.display = "";
          } else {
            productDivs[i].style.display = "none";
          }
        }
      }

      function refreshProducts() {
        loadProducts();
      }

      window.onload = loadProducts;
    </script>
  </head>
  <body>
    <h1>สินค้าตัวอย่าง</h1>
    <div id="searchContainer">
      <input type="text" id="searchInput" onkeyup="searchProducts()" placeholder="ค้นหาสินค้า...">
    </div>
    <div id="refreshContainer">
      <button id="refreshButton" onclick="refreshProducts()">รีสินค้าล่าสุด</button>
      <div id="refreshDescription">รีเพื่อดูสินค้าที่อัพเดตมาล่าสุด</div>
    </div>
    <div id="product-container-wrapper">
      <div id="loader-text" class="loader-text">กำลังโหลด<span>.</span><span>.</span><span>.</span></div>
      <div id="product-container"></div>
    </div>
    <div id="notification" class="notification"></div>
  </body>
</html>
